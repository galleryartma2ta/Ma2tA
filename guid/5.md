**توضیحات کامل پیکربندی پروژه Ma2tA (گام ۵):**

---

### **۱. پیکربندی بک‌اند (Go + Gin)**

#### **فایل‌های مهم:**
- **`.env`** (تنظیمات محیطی)  
- **`config/config.go`** (خواندن تنظیمات از `.env`)

---

#### **مراحل پیکربندی:**
1. **ایجاد فایل `.env` در پوشه `backend`:**
   ```bash
   cd backend
   touch .env
   ```

2. **محتویات فایل `.env`:**
   ```env
   # حالت اجرا (development/production)
   GIN_MODE=debug

   # مسیر دیتابیس SQLite
   DB_PATH=./data/ma2ta.db

   # تنظیمات زرین‌پال
   ZARINPAL_MERCHANT_ID=your_merchant_id
   ZARINPAL_CALLBACK_URL=http://localhost:8080/api/v1/payment/verify

   # پورت سرور
   PORT=8080

   # تنظیمات Redis (اختیاری)
   REDIS_ADDRESS=redis:6379
   REDIS_PASSWORD=
   ```

3. **خواندن تنظیمات در کد Go (`config/config.go`):**
   ```go
   package config

   import (
       "github.com/joho/godotenv"
       "log"
       "os"
   )

   type Config struct {
       DBPath          string
       Port            string
       ZarinpalMerchantID string
   }

   func Load() *Config {
       err := godotenv.Load()
       if err != nil {
           log.Fatal("Error loading .env file")
       }

       return &Config{
           DBPath:          os.Getenv("DB_PATH"),
           Port:            os.Getenv("PORT"),
           ZarinpalMerchantID: os.Getenv("ZARINPAL_MERCHANT_ID"),
       }
   }
   ```

4. **استفاده در `main.go`:**
   ```go
   func main() {
       cfg := config.Load()
       r := gin.Default()
       r.Run(":" + cfg.Port)
   }
   ```

---

### **۲. پیکربندی فرانت‌اند (SvelteKit + Tailwind)**

#### **فایل‌های مهم:**
- **`.env`** (تنظیمات محیطی)  
- **`svelte.config.js`** (کانفیگ SvelteKit)  
- **`tailwind.config.js`** (کانفیگ Tailwind)

---

#### **مراحل پیکربندی:**
1. **ایجاد فایل `.env` در پوشه `frontend`:**
   ```bash
   cd frontend
   touch .env
   ```

2. **محتویات فایل `.env`:**
   ```env
   # آدرس API بک‌اند
   VITE_API_URL=http://localhost:8080/api

   # زبان پیش‌فرض
   VITE_DEFAULT_LANG=fa

   # حالت توسعه
   VITE_DEBUG_MODE=true
   ```

3. **خواندن تنظیمات در کد Svelte (`src/lib/config.ts`):**
   ```typescript
   export const API_URL = import.meta.env.VITE_API_URL;
   export const DEFAULT_LANG = import.meta.env.VITE_DEFAULT_LANG || 'fa';
   ```

4. **تنظیمات Tailwind (`tailwind.config.js`):**
   ```javascript
   module.exports = {
       content: ['./src/**/*.{svelte,js,ts}'],
       theme: {
           extend: {
               fontFamily: {
                   'sans': ['Vazir', 'sans-serif']
               }
           },
       },
       plugins: [],
   }
   ```

---

### **۳. پیکربندی موبایل (Flutter)**

#### **فایل‌های مهم:**
- **`lib/config.dart`** (تنظیمات عمومی)  
- **`pubspec.yaml`** (وابستگی‌ها و منابع)

---

#### **مراحل پیکربندی:**
1. **ویرایش فایل `lib/config.dart`:**
   ```dart
   class AppConfig {
       // آدرس API بک‌اند
       static const String apiUrl = "http://10.0.2.2:8080/api";

       // کالبک پرداخت زرین‌پال
       static const String zarinpalCallback = "zarinpal://ma2ta-verify";

       // کلید نقشه (اختیاری)
       static const String googleMapsKey = "your_google_maps_key";
   }
   ```

2. **تنظیم وابستگی‌ها در `pubspec.yaml`:**
   ```yaml
   dependencies:
     flutter:
       sdk: flutter
     dio: ^5.3.0
     webview_flutter: ^4.4.0
     cached_network_image: ^3.3.0
   ```

3. **افزودن منابع (عکس‌ها، فونت‌ها):**
   ```yaml
   flutter:
     assets:
       - assets/images/
     fonts:
       - family: Vazir
         fonts:
           - asset: assets/fonts/Vazir.ttf
   ```

---

### **۴. پیکربندی Docker (اختیاری)**

#### **ویرایش `docker-compose.yml`:**
```yaml
services:
  backend:
    environment:
      - DB_PATH=/data/ma2ta.db
      - ZARINPAL_MERCHANT_ID=your_merchant_id
    volumes:
      - ./data:/data

  frontend:
    environment:
      - VITE_API_URL=http://backend:8080/api
```

---

### **۵. پیکربندی امنیتی (Critical!)**
1. **عدم commit کردن `.env`:  
   - فایل `.gitignore` را بررسی کنید:
     ```bash
     # در .gitignore
     *.env
     ```

2. **تنظیمات CORS در بک‌اند:**
   ```go
   // middleware/cors.go
   func CORSMiddleware() gin.HandlerFunc {
       return func(c *gin.Context) {
           c.Writer.Header().Set("Access-Control-Allow-Origin", "*")
           c.Writer.Header().Set("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE")
           c.Writer.Header().Set("Access-Control-Allow-Headers", "Content-Type, Authorization")
           c.Next()
       }
   }
   ```

---

### **مشکلات رایج و راه‌حل‌ها**
#### **۱. خطای `Environment variable not found`**
- **علت:** فراموشی بارگذاری `.env` در Go.  
- **راه‌حل:**  
  ```go
  // در main.go
  _ = godotenv.Load()
  ```

#### **۲. خطای `Connection refused` در فرانت‌اند**
- **علت:** آدرس API نادرست.  
- **راه‌حل:**  
  - در حالت توسعه: `http://localhost:8080/api`  
  - در Docker: `http://backend:8080/api`

#### **۳. خطای `Invalid merchant ID` در زرین‌پال**
- **علت:** Merchant ID نادرست یا عدم فعال‌سازی Sandbox.  
- **راه‌حل:**  
  - از پنل زرین‌پال یک Merchant ID معتبر دریافت کنید.  
  - در حالت تست از `Sandbox` استفاده کنید.

---

**نکات نهایی:**  
- پس از هر تغییر در تنظیمات، سرورها را **ری‌استارت** کنید.  
- برای محیط تولید، از **متغیرهای محیطی سرور** (نه فایل `.env`) استفاده کنید.  
- تنظیمات حساس (مثل کلیدهای API) را **هرگز** در ریپازیتوری عمومی قرار ندهید! 🔒