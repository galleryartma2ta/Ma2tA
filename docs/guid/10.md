**عیب‌یابی رایج در پروژه Ma2tA و راه‌حل‌ها:**

---

### **۱. خطای CORS در API (بک‌اند)**
- **علائم:**  
  درخواست‌های فرانت‌اند با خطای `CORS Policy` مواجه می‌شوند.
- **علت:**  
  سرور بک‌اند اجازه دسترسی از دامنه فرانت‌اند را نمی‌دهد.
- **راه‌حل:**  
  فعال کردن CORS در میدلور Gin:
  ```go
  // middleware/cors.go
  func CORSMiddleware() gin.HandlerFunc {
      return func(c *gin.Context) {
          c.Writer.Header().Set("Access-Control-Allow-Origin", "*")
          c.Writer.Header().Set("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE")
          c.Writer.Header().Set("Access-Control-Allow-Headers", "Content-Type, Authorization")
          c.Next()
      }
  }
  ```
  - ثبت میدلور در `main.go`:
    ```go
    r.Use(middleware.CORSMiddleware())
    ```

---

### **۲. خطای اتصال به دیتابیس**
- **علائم:**  
  `database is locked` (SQLite) یا `connection refused` (PostgreSQL).
- **علت:**  
  - دسترسی همزمان چندین فرایند به SQLite.  
  - تنظیمات نادرست دیتابیس در محیط Production.
- **راه‌حل:**  
  - **برای SQLite:**  
    ```go
    db, err := sql.Open("sqlite3", "file:ma2ta.db?cache=shared&_journal_mode=WAL")
    db.SetMaxOpenConns(1) // فقط در محیط توسعه
    ```
  - **برای PostgreSQL:**  
    - بررسی IP/Port دیتابیس در فایل `.env`.  
    - اطمینان از اجرا بودن سرویس PostgreSQL:
      ```bash
      sudo systemctl status postgresql
      ```

---

### **۳. خطای `Cannot GET /path` در فرانت‌اند (SvelteKit)**
- **علائم:**  
  صفحه‌های مسیرهای (Routes) SvelteKit پس از دیپلوی بارگذاری نمی‌شوند.
- **علت:**  
  تنظیمات اشتباه در سرور وب (مثل Nginx) برای مسیرهای SPA.
- **راه‌حل:**  
  - **کانفیگ Nginx برای SPA:**
    ```nginx
    location / {
        try_files $uri $uri/ /index.html;
    }
    ```

---

### **۴. خطای `Invalid Merchant ID` در زرین‌پال**
- **علائم:**  
  درخواست پرداخت با خطای `Merchant ID نامعتبر` مواجه می‌شود.
- **علت:**  
  - `Merchant ID` در فایل `.env` تنظیم نشده یا نادرست است.  
  - حالت Sandbox فعال نیست.
- **راه‌حل:**  
  - دریافت `Merchant ID` از [پنل زرین‌پال](https://next.zarinpal.com).  
  - در حالت توسعه از `Sandbox` استفاده کنید:
    ```go
    zarinpal.EnableSandbox()
    ```

---

### **۵. کانتینرهای Docker اجرا نمی‌شوند**
- **علائم:**  
  دستور `docker-compose up` با خطای `Exited (1)` مواجه می‌شود.
- **علت:**  
  - پورت‌های تکراری.  
  - خطا در ساخت ایمیج (مثلاً وابستگی‌های ناقص).
- **راه‌حل:**  
  - مشاهده لاگ‌ها:
    ```bash
    docker-compose logs -f backend
    ```
  - آزاد کردن پورت‌های مورد استفاده:
    ```bash
    sudo lsof -i :8080
    sudo kill -9 <PID>
    ```

---

### **۶. خطای `Hot Reload` در Flutter**
- **علائم:**  
  تغییرات کد در Flutter به صورت خودکار اعمال نمی‌شود.
- **علت:**  
  - کش خراب Flutter.  
  - مشکلات در اتصال دستگاه.
- **راه‌حل:**  
  - پاکسازی کش:
    ```bash
    flutter clean
    flutter pub get
    ```
  - ری‌استارت کردن شبیه‌ساز یا دستگاه.

---

### **۷. خطای `404 Not Found` در API**
- **علائم:**  
  درخواست به آدرس API با خطای `404` پاسخ داده می‌شود.
- **علت:**  
  - مسیر (Endpoint) اشتباه.  
  - Routeهای Gin به درستی ثبت نشده‌اند.
- **راه‌حل:**  
  - بررسی مستندات API و تطبیق مسیرها.  
  - ثبت Routeها در `main.go`:
    ```go
    r.GET("/api/v1/products", handlers.GetProducts)
    ```

---

### **۸. عملکرد کند سرور در محیط Production**
- **علائم:**  
  تأخیر در پاسخگویی API یا بارگذاری صفحات.
- **علت:**  
  - عدم استفاده از کش (Redis).  
  - تنظیمات نادرست منابع Docker.
- **راه‌حل:**  
  - **فعال‌سازی کش:**  
    ```go
    // استفاده از Redis برای کش
    cache := redis.NewClient(&redis.Options{Addr: "redis:6379"})
    ```
  - **محدود کردن منابع در Docker:**
    ```yaml
    services:
      backend:
        deploy:
          resources:
            limits:
              cpus: '1'
              memory: 512M
    ```

---

### **۹. خطای `Mixed Content` در HTTPS**
- **علائم:**  
  مرورگر به دلیل وجود محتوای ناامن (HTTP) در صفحه HTTPS خطا می‌دهد.
- **علت:**  
  - لینک‌های داخلی (مثل عکس یا API) با `http` بارگذاری می‌شوند.
- **راه‌حل:**  
  - اطمینان از استفاده از پروتکل `https` در تمامی URLها:
    ```env
    # فایل .env فرانت‌اند
    VITE_API_URL=https://api.ma2ta.com
    ```

---

### **۱۰. خطای `Database Migration Failed`**
- **علائم:**  
  مهاجرت‌های دیتابیس با خطا مواجه می‌شوند.
- **علت:**  
  - دسترسی نداشتن به دیتابیس.  
  - خطا در اسکریپت‌های مهاجرت.
- **راه‌حل:**  
  - بررسی مجوزهای کاربر دیتابیس:
    ```sql
    GRANT ALL PRIVILEGES ON DATABASE ma2ta TO ma2ta;
    ```
  - اجرای دستی مهاجرت‌ها:
    ```bash
    docker exec -it ma2ta-backend bash
    goose -dir migrations postgres "user=ma2ta password=pass dbname=ma2ta sslmode=disable" up
    ```

---

### **نکات کلی عیب‌یابی**
1. **بررسی لاگ‌ها:**  
   - Docker: `docker-compose logs -f <service_name>`  
   - Go: `gin.Default()` در حالت `DebugMode`  
   - Flutter: `flutter logs -d <device_id>`

2. **تست جداگانه سرویس‌ها:**  
   - API: `curl http://localhost:8080/api/v1/health`  
   - فرانت‌اند: باز کردن `http://localhost:3000` در مرورگر.

3. **بررسی اتصال شبکه:**  
   ```bash
   ping api.ma2ta.com
   telnet api.ma2ta.com 8080
   ```

4. **مستندات و جامعه:**  
   - مراجعه به [مستندات پروژه](https://github.com/yourusername/Ma2ta/wiki).  
   - جستجوی خطا در StackOverflow با تگ‌های مرتبط (Go, SvelteKit, Flutter).

اگر مشکل شما در این لیست نیست، لاگ‌ها و کد مرتبط را در **[Issues گیتهاب](https://github.com/yourusername/Ma2tA/issues)** مطرح کنید! 🛠️