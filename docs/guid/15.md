**Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ú†Ù†Ø¯ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ma2tA**  
Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ú†Ù†Ø¯ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª (Ù…Ø«Ù„ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ØŒ Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒØŒ Ùˆ Ù†ÙˆÛŒÙ†) Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ØŒ Ù…Ø±Ø§Ø­Ù„ Ø²ÛŒØ± Ø±Ø§ Ø¯Ù†Ø¨Ø§Ù„ Ú©Ù†ÛŒØ¯:

---

### **Û±. Ø·Ø±Ø§Ø­ÛŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª**
#### **Ø§Ù„Ú¯ÙˆÛŒ Ø·Ø±Ø§Ø­ÛŒ (Strategy Pattern)**
- **Payment Gateway Interface:**  
  ```go
  type PaymentGateway interface {
      InitiatePayment(amount int64, callbackURL string) (paymentURL string, err error)
      VerifyPayment(paymentID string) (success bool, err error)
      Refund(paymentID string) (success bool, err error)
  }
  ```

#### **Ø³Ø§Ø®ØªØ§Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³**
- **Ø¬Ø¯ÙˆÙ„ `payment_gateways`:**  
  | ÙÛŒÙ„Ø¯         | Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡     | ØªÙˆØ¶ÛŒØ­Ø§Øª                     |  
  |--------------|-------------|----------------------------|  
  | `id`         | UUID        | Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§                 |  
  | `name`       | VARCHAR     | Ù†Ø§Ù… Ø¯Ø±Ú¯Ø§Ù‡ (Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ØŒ Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒØŒ ...) |  
  | `is_active`  | BOOLEAN     | ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„         |  
  | `config`     | JSONB       | ØªÙ†Ø¸ÛŒÙ…Ø§Øª (API Key, Merchant ID, ...) |  

- **Ø¬Ø¯ÙˆÙ„ `transactions`:**  
  | ÙÛŒÙ„Ø¯            | Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡     | ØªÙˆØ¶ÛŒØ­Ø§Øª                     |  
  |-----------------|-------------|----------------------------|  
  | `id`            | UUID        | Ø´Ù†Ø§Ø³Ù‡ ØªØ±Ø§Ú©Ù†Ø´               |  
  | `gateway_id`    | UUID        | Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª         |  
  | `amount`        | BIGINT      | Ù…Ø¨Ù„Øº Ø¨Ù‡ Ø±ÛŒØ§Ù„               |  
  | `status`        | ENUM        | ÙˆØ¶Ø¹ÛŒØª (pending, success, failed) |  
  | `payment_id`    | VARCHAR     | Ø´Ù†Ø§Ø³Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø¯Ø±Ú¯Ø§Ù‡      |  

---

### **Û². Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª**  
#### **Ø§Ù„Ù) Ø¯Ø±Ú¯Ø§Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ (Zarinpal)**  
```go
type ZarinpalGateway struct {
    MerchantID  string
    Sandbox     bool
}

func (z *ZarinpalGateway) InitiatePayment(amount int64, callbackURL string) (string, error) {
    // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„
    req := map[string]interface{}{
        "merchant_id":  z.MerchantID,
        "amount":       amount,
        "callback_url": callbackURL,
        "description":  "Ø®Ø±ÛŒØ¯ Ø§Ø² Ma2tA",
    }
    // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒÙ†Ú© Ù¾Ø±Ø¯Ø§Ø®Øª
}

func (z *ZarinpalGateway) VerifyPayment(paymentID string) (bool, error) {
    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
}
```

#### **Ø¨) Ø¯Ø±Ú¯Ø§Ù‡ Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒ (IDPay)**  
```go
type IDPayGateway struct {
    APIKey string
}

func (i *IDPayGateway) InitiatePayment(amount int64, callbackURL string) (string, error) {
    // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API Ø¢ÛŒØ¯ÛŒ Ù¾ÛŒ
}
```

---

### **Û³. Ø³Ø±ÙˆÛŒØ³ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª (Payment Service)**  
#### **Ø§Ù„Ù) Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª**  
```go
func GetActiveGateway() (PaymentGateway, error) {
    var gateway PaymentGateway
    // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ú¯Ø§Ù‡ ÙØ¹Ø§Ù„ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    err := db.Where("is_active = ?", true).First(&gateway).Error
    return gateway, err
}
```

#### **Ø¨) Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´**  
```go
func CreateTransaction(amount int64, userID string) (*Transaction, error) {
    gateway, _ := GetActiveGateway()
    callbackURL := "https://ma2ta.com/payment/verify"
    
    paymentURL, err := gateway.InitiatePayment(amount, callbackURL)
    if err != nil {
        return nil, err
    }
    
    // Ø°Ø®ÛŒØ±Ù‡ ØªØ±Ø§Ú©Ù†Ø´ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    tx := Transaction{
        GatewayID:  gateway.ID,
        Amount:     amount,
        Status:     "pending",
        PaymentID:  paymentID,
    }
    db.Create(&tx)
    
    return &tx, nil
}
```

---

### **Û´. APIÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª**  
#### **Ø§Ù„Ù) Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª**  
```http
POST /api/payment/create
Authorization: Bearer <token>
Content-Type: application/json

{ "amount": 100000 }
```

#### **Ø¨) ØªØ§ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª**  
```http
GET /api/payment/verify?payment_id=12345&status=OK
```

---

### **Ûµ. Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ Ùˆ Fallback**  
- **Fallback Ø®ÙˆØ¯Ú©Ø§Ø±:**  
  Ø§Ú¯Ø± Ø¯Ø±Ú¯Ø§Ù‡ Ø§ØµÙ„ÛŒ Ù¾Ø§Ø³Ø® Ù†Ø¯Ù‡Ø¯ØŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø³ÙˆØ¦ÛŒÚ† Ú©Ù†Ø¯.  
  ```go
  func ProcessPayment(amount int64) (string, error) {
      gateways := GetActiveGateways() // Ù„ÛŒØ³Øª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§ÙˆÙ„ÙˆÛŒØª
      for _, gateway := range gateways {
          paymentURL, err := gateway.InitiatePayment(amount)
          if err == nil {
              return paymentURL, nil
          }
      }
      return "", errors.New("ØªÙ…Ø§Ù… Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù†Ø¯")
  }
  ```

---

### **Û¶. Ø§Ù…Ù†ÛŒØª**  
- **Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³:**  
  Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ `API Key` Ùˆ `Merchant ID` Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ AES.  
- **Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ IP:**  
  ØªØ§ÛŒÛŒØ¯ IP Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¹Ù„ÛŒ.  

---

### **Û·. ØªØ³Øªâ€ŒÙ‡Ø§**  
#### **Ø§Ù„Ù) ØªØ³Øª ÙˆØ§Ø­Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„**  
```go
func TestZarinpalPayment(t *testing.T) {
    gateway := ZarinpalGateway{MerchantID: "test", Sandbox: true}
    url, err := gateway.InitiatePayment(10000, "https://callback")
    assert.NoError(t, err)
    assert.Contains(t, url, "zarinpal.com")
}
```

#### **Ø¨) ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ**  
```go
func TestPaymentFlow(t *testing.T) {
    // Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´
    tx, _ := CreateTransaction(10000, "user123")
    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡
    success, _ := VerifyPayment(tx.PaymentID)
    assert.True(t, success)
}
```

---

### **Û¸. Ù…Ø³ØªÙ†Ø¯Ø§Øª ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†**  
Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ú¯Ø§Ù‡ Ø¬Ø¯ÛŒØ¯:  
Û±. Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ†ØªØ±ÙÛŒØ³ `PaymentGateway`.  
Û². Ø«Ø¨Øª Ø¯Ø±Ú¯Ø§Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±Ø¨ÙˆØ·Ù‡.  
Û³. Ø§ÙØ²ÙˆØ¯Ù† ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù….  

---

**Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ:**  
Ø¨Ø§ Ø§ÛŒÙ† Ù…Ø¹Ù…Ø§Ø±ÛŒØŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ma2tA Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø² **Ú†Ù†Ø¯ÛŒÙ† Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª** Ø¨Ù‡ ØµÙˆØ±Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ù†Ø¯ Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„ Ø¯Ø± ÛŒÚ© Ø¯Ø±Ú¯Ø§Ù‡ØŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø¯! ğŸ’³ğŸš€