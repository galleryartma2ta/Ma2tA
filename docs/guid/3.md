**راهنمای جامع راه‌اندازی محیط توسعه با Docker برای پروژه Ma2tA**

---

### **۱. نصب Docker و Docker Compose**
- **ویندوز:**  
  - Docker Desktop را از [این لینک](https://www.docker.com/products/docker-desktop/) دانلود و نصب کنید.  
  - در طول نصب، گزینه **"Use WSL 2 based engine"** را فعال کنید.  
  - پس از نصب، Docker را اجرا و از منوی تنظیمات (**Settings**) گزینه **Resources > WSL Integration** را فعال کنید.  

- **لینوکس (Ubuntu در WSL2):**  
  ```bash
  sudo apt update
  sudo apt install docker.io docker-compose
  sudo systemctl enable docker
  sudo systemctl start docker
  # افزودن کاربر به گروه Docker (اختیاری)
  sudo usermod -aG docker $USER
  newgrp docker
  ```

---

### **۲. بررسی فایل‌های Docker پروژه**
پروژه Ma2tA شامل دو فایل اصلی Docker است:
1. **`Dockerfile`** (برای ساخت ایمیج بک‌اند)  
2. **`docker-compose.yml`** (برای اجرای چند سرویس با هم)

#### محتوای نمونه `docker-compose.yml`:
```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8080:8080"
    volumes:
      - ./backend:/app
      - ./data:/data
    environment:
      - GIN_MODE=debug
      - DB_PATH=/data/ma2ta.db
    depends_on:
      - redis

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
    environment:
      - VITE_API_URL=http://backend:8080/api

  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  redis_data:
```

---

### **۳. ساخت و اجرای کانتینرها**
1. **اجرای دستور Docker Compose:**  
   در ریشه پروژه (محل فایل `docker-compose.yml`) دستور زیر را اجرا کنید:
   ```bash
   docker-compose up -d --build
   ```
   - `-d`: اجرای کانتینرها در پس‌زمینه (Detached Mode).  
   - `--build`: ساخت ایمیج‌ها از نو.

2. **بررسی وضعیت کانتینرها:**  
   ```bash
   docker-compose ps
   ```
   خروجی باید مشابه زیر باشد:
   ```
   NAME                COMMAND                  STATUS              PORTS
   ma2ta-backend       "/app/main"              Up 5 minutes        0.0.0.0:8080->8080/tcp
   ma2ta-frontend      "npm run dev"            Up 5 minutes        0.0.0.0:3000->3000/tcp
   ma2ta-redis         "docker-entrypoint.s…"   Up 5 minutes        0.0.0.0:6379->6379/tcp
   ```

---

### **۴. دسترسی به سرویس‌ها**
- **بک‌اند (Go):**  
  - آدرس: `http://localhost:8080`  
  - تست سلامت (Health Check):  
    ```bash
    curl http://localhost:8080/api/v1/health
    ```

- **فرانت‌اند (SvelteKit):**  
  - آدرس: `http://localhost:3000`

- **Redis:**  
  - پورت: `6379` (برای اتصال از داخل کانتینرها).

---

### **۵. مدیریت کانتینرها**
- **توقف کانتینرها:**  
  ```bash
  docker-compose down
  ```

- **حذف حجم‌های ذخیره‌سازی (Volumes):**  
  ```bash
  docker-compose down -v
  ```

- **مشاهده لاگ کانتینرها:**  
  ```bash
  docker-compose logs -f backend
  ```

---

### **۶. رفع خطاهای رایج**
#### **۱. خطای `Port already in use`**
- **علت:** پورت ۸۰۸۰ یا ۳۰۰۰ توسط برنامه دیگری استفاده می‌شود.  
- **راه‌حل:**  
  - برنامه‌های استفاده‌کننده از پورت را ببندید (مثلاً VS Code یا سایر سرورها).  
  - یا پورت‌های پروژه را در `docker-compose.yml` تغییر دهید:  
    ```yaml
    ports:
      - "8081:8080" # پورت جدید: 8081
    ```

#### **۲. خطای `Build failed`**
- **علت:** خطا در ساخت ایمیج (مثلاً وابستگی‌های ناقص).  
- **راه‌حل:**  
  - فایل `Dockerfile` را بررسی کنید.  
  - از صحت دستورات نصب وابستگی‌ها اطمینان حاصل کنید.  

#### **۳. خطای اتصال به دیتابیس**
- **علت:** دیتابیس در کانتینر اجرا نشده است.  
- **راه‌حل:**  
  - مطمئن شوید سرویس دیتابیس (مثل Redis) در `docker-compose.yml` تعریف شده است.  
  - دستور `docker-compose up` را دوباره اجرا کنید.  

---

### **۷. توسعه در محیط Docker**
- **اتصال به کانتینر بک‌اند:**  
  ```bash
  docker exec -it ma2ta-backend bash
  ```
  - درون کانتینر می‌توانید فایل‌ها را ویرایش و سرور را ری‌استارت کنید.

- **بروزرسانی کانتینرها پس از تغییر کد:**  
  ```bash
  docker-compose up -d --build
  ```

---

### **۸. تنظیمات پیشرفته**
- **استفاده از Docker Volume برای دیتابیس:**  
  در `docker-compose.yml`:  
  ```yaml
  volumes:
    - postgres_data:/var/lib/postgresql/data

  volumes:
    postgres_data:
  ```

- **اضافه کردن محیط‌های توسعه (Dev Containers):**  
  - از اکستنشن **Remote - Containers** در VS Code استفاده کنید.  
  - فایل `.devcontainer/devcontainer.json` را ایجاد و تنظیمات را وارد کنید.

---

**نکات نهایی:**  
- همیشه از **Docker Compose** برای مدیریت چند سرویس استفاده کنید.  
- برای محیط تولید، ایمیج‌ها را بهینه‌سازی کنید (مثلاً استفاده از ایمیج‌های Alpine).  
- لاگ‌ها را مرتباً بررسی کنید تا از سلامت سرویس‌ها مطمئن شوید.  

اگر نیاز به راهنمایی بیشتر دارید، می‌توانید از **[مستندات رسمی Docker](https://docs.docker.com/)** استفاده کنید یا مشکل خود را در **[Issues گیتهاب](https://github.com/yourusername/Ma2tA/issues)** مطرح کنید! 🐳🚀